#!/bin/sh
set -eu

LOG=/var/log/aulalliure-fix-apt-sources.log
mkdir -p /var/log /etc/apt/sources.list.d /etc/aulalliure

{
  echo "[fix-apt-sources] start"

  : > /etc/apt/sources.list

  cat > /etc/apt/sources.list.d/debian.sources <<'EOL'
Types: deb
URIs: http://deb.debian.org/debian
Suites: trixie trixie-updates
Components: main contrib non-free non-free-firmware
Signed-By: /usr/share/keyrings/debian-archive-keyring.gpg

Types: deb
URIs: http://security.debian.org/debian-security
Suites: trixie-security
Components: main contrib non-free non-free-firmware
Signed-By: /usr/share/keyrings/debian-archive-keyring.gpg
EOL

  rm -f /etc/apt/sources.list.d/cdrom*.list /etc/apt/sources.list.d/*cdrom* 2>/dev/null || true
  sed -i '/^deb cdrom:/d' /etc/apt/sources.list 2>/dev/null || true

  touch /etc/aulalliure/apt-sources-fixed
  echo "[fix-apt-sources] done"
} >> "$LOG" 2>&1 || true
