### Localization
# Valencian Catalan locale
d-i localechooser/supported-locales multiselect ca_ES.UTF-8, ca_ES@valencia.UTF-8
d-i debian-installer/locale string ca_ES@valencia.UTF-8
d-i keyboard-configuration/xkb-keymap select es

d-i netcfg/choose_interface select auto
d-i netcfg/get_hostname string aulalliure
d-i netcfg/get_domain string local

d-i mirror/country string manual
d-i mirror/http/hostname string deb.debian.org
d-i mirror/http/directory string /debian
d-i mirror/http/proxy string

### Account setup
# WARNING: change these defaults

d-i passwd/root-login boolean false
d-i passwd/make-user boolean true
d-i passwd/user-fullname string AulaLliure
d-i passwd/username string aulalliure
# Password is "lliure" (sha-512). Replace before shipping.
d-i passwd/user-password-crypted password $6$aulalliure$RXmxfuPqQVrzpirIpXSa2xMfF7RmrTc.Ymk9obB/RB0oSSV5VT31EGff.hIwH6pBow5SUQOSrxgGhKuc4hScP1

### Timezone

d-i time/zone string Europe/Madrid

d-i clock-setup/utc boolean true

d-i clock-setup/ntp boolean true

### Partitioning (uses whole disk automatically)

d-i partman-auto/method string regular
d-i partman-auto/choose_recipe select atomic
d-i partman-lvm/device_remove_lvm boolean true
d-i partman-md/device_remove_md boolean true
d-i partman-partitioning/confirm_write_new_label boolean true
d-i partman/confirm boolean true
d-i partman/confirm_nooverwrite boolean true

### Package selection

tasksel tasksel/first multiselect standard

d-i pkgsel/include string openssh-server sudo moksha moksha-data moksha-menu xorg lightdm lightdm-gtk-greeter network-manager nano pluma

d-i pkgsel/upgrade select none

### Boot loader

d-i grub-installer/only_debian boolean true
d-i grub-installer/with_other_os boolean true

### Finish install

d-i finish-install/reboot_in_progress note
d-i preseed/late_command string /bin/sh -c "LOG=/target/var/log/aulalliure-late_command.log; mkdir -p /target/var/log /target/etc/apt/sources.list.d /target/usr/share/keyrings /target/usr/local/bin /target/etc/xdg/autostart /target/usr/share/backgrounds /target/etc/lightdm/lightdm.conf.d /target/etc/systemd/system/getty@tty1.service.d /target/etc/X11 /target/etc/aulalliure; : > \"$LOG\"; echo \"late_command start\" >> \"$LOG\"; { cp -v /cdrom/aulalliure/bodhi/bodhi-archive-keyring.gpg /target/usr/share/keyrings/ || true; cp -v /cdrom/aulalliure/bodhi/bodhi-repo.sources /target/etc/apt/sources.list.d/ || true; cp -v /cdrom/aulalliure/usr/local/bin/aulalliure-set-wallpaper /target/usr/local/bin/ || true; chmod 755 /target/usr/local/bin/aulalliure-set-wallpaper || true; cp -v /cdrom/aulalliure/etc/xdg/autostart/aulalliure-wallpaper.desktop /target/etc/xdg/autostart/ || true; cp -v /cdrom/aulalliure/usr/share/backgrounds/*.jpg /target/usr/share/backgrounds/ || true; printf \"%s\\n\" \"deb http://deb.debian.org/debian trixie main contrib non-free non-free-firmware\" \"deb http://deb.debian.org/debian trixie-updates main contrib non-free non-free-firmware\" \"deb http://security.debian.org/debian-security trixie-security main contrib non-free non-free-firmware\" > /target/etc/apt/sources.list; printf \"%s\\n\" \"[Seat:*]\" \"autologin-user=aulalliure\" \"autologin-user-timeout=0\" \"autologin-group=autologin\" \"user-session=enlightenment\" \"autologin-session=enlightenment\" \"greeter-session=lightdm-gtk-greeter\" > /target/etc/lightdm/lightdm.conf.d/50-aulalliure-autologin.conf; printf \"%s\\n\" \"[Seat:*]\" \"autologin-user=aulalliure\" \"autologin-user-timeout=0\" \"autologin-group=autologin\" \"user-session=enlightenment\" \"autologin-session=enlightenment\" \"greeter-session=lightdm-gtk-greeter\" > /target/etc/lightdm/lightdm.conf; printf \"%s\\n\" \"/usr/sbin/lightdm\" > /target/etc/X11/default-display-manager; ln -sf /lib/systemd/system/lightdm.service /target/etc/systemd/system/display-manager.service; printf \"%s\\n\" \"[Service]\" \"ExecStart=\" \"ExecStart=-/sbin/agetty --autologin aulalliure --noclear %I \\\$TERM\" > /target/etc/systemd/system/getty@tty1.service.d/override.conf; } >> \"$LOG\" 2>&1; in-target /bin/sh -c \"printf '%s\\n' 'lightdm shared/default-x-display-manager select lightdm' | debconf-set-selections\" >> \"$LOG\" 2>&1 || true; in-target apt-get update >> \"$LOG\" 2>&1 || true; in-target /bin/sh -c \"DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends ca-certificates curl gnupg || true\" >> \"$LOG\" 2>&1 || true; in-target /bin/sh -c 'set -e; mkdir -p /usr/share/keyrings /etc/apt/sources.list.d; curl -fsSL https://repo.edutictac.es/repo.key | gpg --dearmor --batch --yes --no-tty -o /usr/share/keyrings/edutictac-repo.gpg; chmod 0644 /usr/share/keyrings/edutictac-repo.gpg; printf "%s\\n" "deb [arch=amd64 signed-by=/usr/share/keyrings/edutictac-repo.gpg] https://repo.edutictac.es trixie main" > /etc/apt/sources.list.d/edutictac.list; chmod 0644 /etc/apt/sources.list.d/edutictac.list' >> \"$LOG\" 2>&1 || true; in-target apt-get update >> \"$LOG\" 2>&1 || true; in-target /bin/sh -c \"DEBIAN_FRONTEND=noninteractive apt-get install -y moksha moksha-data moksha-menu xorg lightdm lightdm-gtk-greeter network-manager nano pluma educontrol.client || true\" >> \"$LOG\" 2>&1; in-target systemctl set-default graphical.target >> \"$LOG\" 2>&1 || true; in-target /bin/sh -c \"/usr/sbin/groupadd -f autologin || true; /usr/sbin/groupadd -f nopasswdlogin || true; /usr/sbin/usermod -a -G autologin,nopasswdlogin aulalliure || true; systemctl enable lightdm || true; systemctl daemon-reload || true\" >> \"$LOG\" 2>&1 || true; in-target /bin/sh -c ": > /etc/apt/sources.list; printf '%s\\n' 'Types: deb' 'URIs: http://deb.debian.org/debian' 'Suites: trixie trixie-updates' 'Components: main contrib non-free non-free-firmware' 'Signed-By: /usr/share/keyrings/debian-archive-keyring.gpg' '' 'Types: deb' 'URIs: http://security.debian.org/debian-security' 'Suites: trixie-security' 'Components: main contrib non-free non-free-firmware' 'Signed-By: /usr/share/keyrings/debian-archive-keyring.gpg' > /etc/apt/sources.list.d/debian.sources; rm -f /etc/apt/sources.list.d/cdrom*.list /etc/apt/sources.list.d/*cdrom* 2>/dev/null || true; sed -i '/^deb cdrom:/d' /etc/apt/sources.list 2>/dev/null || true\" >> \"$LOG\" 2>&1 || true; echo \"late_command end\" >> \"$LOG\"; printf \"%s\\n\" \"ok\" > /target/etc/aulalliure/preseed-ran" || true
